{% extends 'bootstrap/index.html' %} <!--this inherits the bootstrap templates-->
{% block title %} List {% endblock %}
{% block content %} <!--This allows block content from this page to be rendered-->
    <div class="container">
        {% if not current_user.is_authenticated and request.endpoint == 'list' %}
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="alert alert-danger" role="alert">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
        {% endif %}
        {% endwith %}
        {% endif %}
        <h2 class="mb-3 mt-3 text-secondary">Hello, {{ current_user.first_name }}</h2>
        <div class="row">
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header">New Task</div>
                    <div class="card-body">
                        <form action="/add" class="mb-3" method="post">
                            <label for="">Title: </label>
                            <input class="form-control" type="text" name="title1" id="" placeholder="Add Title...">
                            <!-- Display flashed messages with the 'title' category -->
                            {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                            {% for message, category in messages %}
                            {% if message == 'title' %}
                            <div class="container-fluid mt-1">
                                <div class="row justify-content-start">
                                    <div class="col-sm-6">
                                        <p class="alert alert-danger">{{ category }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                            {% endif %}
                            {% endwith %}

                            <label class="mt-2" for="">Description: </label>
                            <!-- <input class="form-control" type="text" name="title" id="" placeholder="Add Description..."> -->
                            <textarea class="form-control" name="description1" id="description" rows="3"
                                placeholder="Add Description..."></textarea>
                            <div class="mb-3">
                                <label for="dueDateInput" class="form-label">Due Date</label>
                                <input type="date" class="form-control" id="dueDateInput" name="due_date">
                                {% with messages = get_flashed_messages(with_categories=true) %}
                                {% if messages %}
                                {% for message, category in messages %}
                                {% if message == 'due_date' %}
                                <div class="container mt-1">
                                    <div class="row justify-content-start">
                                        <div class="col-sm-12">
                                            <p class="alert alert-danger">{{ category }}</p>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% endif %}
                                {% endwith %}
                            </div>
                            <div class="col-md-12 text-center">
                                <input class="btn mt-3 btn-lg btn-secondary" type="submit" value="Add">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header">Statistics</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card shadow">
                                    <div class="card-body text-center">
                                        <h6>Total task</h6>
                                        <p class="text-center">{{total_todo}}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card shadow">
                                    <div class="card-body text-center">
                                        <h6>Completed task</h6>
                                        <p class="text-center">{{completed_todo }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card shadow">
                                    <div class="card-body text-center">
                                        <h6>Uncompleted task</h6>
                                        <p class="text-center">{{uncompleted_todo}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if total_todo == 0 %}
        <div class="container-fluid text-secondary text-center mt-3">
            <h3>Your task list is currently empty. Why not add a task?</h3>
        </div>
        {% endif %}

        <div class="border-start border-4 shadow mt-3">
            <!-- <div class="card-header">Lists</div> -->
            {% for todo in todo_list %}
            <div class="card-body shadow">
                <h5 class="mb-0">{{ todo.order }}. {{ todo.title }}</h5>
                <p class="container-fluid">{{ todo.description }}</p>
                <p class="container-fluid mb-0"><b>Due Date:</b> {{ todo.due_date.strftime('%Y-%m-%d') if todo.due_date else 'Not specified' }}</p>
                <div class="container-fluid">
                    {% if todo.complete %}
                    <span class="badge bg-success">Completed</span>
                    {% else %}
                    <span class="badge bg-secondary">Uncompleted</span>
                    {% endif %}
                    <a class="btn btn-sm btn-info" href="/update/{{ todo.id }}">Update</a>
                    <!-- <a class="btn btn-sm btn-secondary" href="">Edit</a> -->

                    <button type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#editModal{{ todo.id }}">
                        Edit
                    </button>
                    
                    <!-- Modal -->
                    <div class="modal fade" id="editModal{{ todo.id }}" tabindex="-1" aria-labelledby="editModal{{ todo.id }}Label"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModal{{ todo.id }}Label">Edit Todo</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <!-- Add form for editing here -->
                                    <form id="editForm{{ todo.id }}" method="post" action="/edit/{{ todo.id }}">
                                        <!-- Add input fields for title and description -->
                                        <input type="hidden" name="_method" value="put"> <!-- Hidden field to specify the method as PUT -->
                                        <div class="mb-3">
                                            <label for="titleInput{{ todo.id }}" class="form-label">New Title</label>
                                            <input type="text" class="form-control" id="titleInput{{ todo.id }}" name="title" placeholder="New Title"
                                                value="{{ todo.title }}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="descriptionInput{{ todo.id }}" class="form-label">New Description</label>
                                            <textarea class="form-control" id="descriptionInput{{ todo.id }}" name="description"
                                                placeholder="New Description">{{ todo.description }}</textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="dueDateInput{{ todo.id }}" class="form-label">Due Date</label>
                                            <input type="date" class="form-control" id="dueDateInput{{ todo.id }}" name="due_date"
                                                value="{{ todo.due_date.strftime('%Y-%m-%d') if todo.due_date else '' }}">
                                        </div>
                                        <!-- Submit button to submit the form -->
                                        <button type="submit" class="btn btn-secondary">Save</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a class="btn btn-sm btn-danger" href="/delete/{{ todo.id }}">Delete</a>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="mt-3 text-center"> <!-- Center-align content -->
            <a href="{{url_for('logout')}}"><button type="submit" class="btn btn-secondary">Logout</button></a>
        </div>
    </div>
{% endblock %}
